<?xml version="1.0" encoding="utf-8" ?>
<ContentPage xmlns="http://schemas.microsoft.com/dotnet/2021/maui"
             xmlns:x="http://schemas.microsoft.com/winfx/2009/xaml" 
             xmlns:customcontrols="clr-namespace:The_Merlin.CustomControls"
             x:Name="myMainPage"
             x:Class="The_Merlin.MainPage">
    <Grid RowDefinitions="auto,*,auto">
        <Editor Grid.Row="0" Text="{Binding DayDesc}" VerticalOptions="Center" AutoSize="TextChanges"></Editor>
        <!-- Todo Section -->
        <VerticalStackLayout Grid.Row="1">
            <Border Margin="0" Padding="2" StrokeThickness=".1" BackgroundColor="{StaticResource Gray600}">
                <Grid>
                    <Grid.ColumnDefinitions>
                        <ColumnDefinition Width="auto"></ColumnDefinition>
                        <ColumnDefinition Width="*"></ColumnDefinition>
                    </Grid.ColumnDefinitions>
                    <SearchBar Grid.Column="0" Text="{Binding DefSearchText}" Placeholder="Add Definition" ReturnType="Go" SearchCommand="{Binding AddQuickTodoDefCommand}" WidthRequest="200" Margin="5,0"></SearchBar>
                    <CollectionView Grid.Column="1" VerticalOptions="Center" ItemsSource="{Binding FilteredTodoDefs}" ItemsLayout="HorizontalList" HorizontalScrollBarVisibility="Never">
                        <CollectionView.ItemTemplate>
                            <DataTemplate>
                                <Button Text="{Binding TodoDefText}" Command="{Binding BindingContext.TodoAddCommand, Source={x:Reference myMainPage}}" CommandParameter="{Binding .}"></Button>
                            </DataTemplate>
                        </CollectionView.ItemTemplate>
                    </CollectionView>
                </Grid>
            </Border>
            <CollectionView ItemsSource="{Binding todoItems}" SelectionMode="None">
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="10,0" Padding="2" StrokeThickness=".1" BackgroundColor="{StaticResource Gray950}">
                            <Grid Padding="5,2,5,2" ColumnDefinitions="*,auto,auto">
                                <Label Grid.Column="0" Text="{Binding TodoText}" VerticalOptions="Center"  HorizontalOptions="Fill" Margin="25,5,25,5"/>
                                <Border Margin="15,0" BackgroundColor="Transparent" StrokeShape="RoundRectangle 30" Grid.Column="1">
                                    <Border.Triggers>
                                        <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="InProgress">
                                            <Setter Property="BackgroundColor" Value="DarkSlateGrey"></Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="Pending">
                                            <Setter Property="BackgroundColor" Value="Transparent"></Setter>
                                        </DataTrigger>
                                        <DataTrigger TargetType="Border" Binding="{Binding Status}" Value="Completed">
                                            <Setter Property="BackgroundColor" Value="DarkOliveGreen"></Setter>
                                        </DataTrigger>
                                    </Border.Triggers>
                                    <Label Text="{Binding Status}" VerticalOptions="Center"  HorizontalOptions="Fill" Margin="15,0"/>
                                </Border>
                                <Button Grid.Column="2" Text="Go" Command="{Binding BindingContext.NavigateToTodoDetail, Source={x:Reference myMainPage}}" CommandParameter="{Binding .}" WidthRequest="44"></Button>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
        <!-- Timeline Section -->
        <VerticalStackLayout Grid.Row="2">
            <customcontrols:TimelineView Items="{Binding TodaysTimelineItems}" x:Name="graphicsView" HeightRequest="60" HorizontalOptions="Fill"></customcontrols:TimelineView>
            <CollectionView ItemsSource="{Binding TimelineLast5}" SelectionMode="None">
                <CollectionView.Header>
                    <Grid>
                        <Grid.ColumnDefinitions>
                            <ColumnDefinition Width="*"></ColumnDefinition>
                            <ColumnDefinition Width="50"></ColumnDefinition>
                            <ColumnDefinition Width="60"></ColumnDefinition>
                            <ColumnDefinition Width="50"></ColumnDefinition>
                        </Grid.ColumnDefinitions>
                        <Label Text="Son 5 aktivite" Grid.Column="0" HorizontalOptions="Start" Margin="15,0" TextColor="AliceBlue" FontSize="10"></Label>
                        <Label Text="Starts" Grid.Column="1" HorizontalOptions="Center" TextColor="{StaticResource Gray400}" FontSize="10"></Label>
                        <Label Text="Time" Grid.Column="2" HorizontalOptions="Center" TextColor="{StaticResource Gray400}" FontSize="10"></Label>
                        <Label Text="Ends" Grid.Column="3" HorizontalOptions="Center" TextColor="{StaticResource Gray400}" FontSize="10"></Label>
                    </Grid>
                </CollectionView.Header>
                <CollectionView.ItemTemplate>
                    <DataTemplate>
                        <Border Margin="10,0" Padding="2" StrokeThickness=".1" BackgroundColor="{StaticResource Gray950}">
                            <Grid>
                                <Grid.ColumnDefinitions>
                                    <ColumnDefinition Width="*"></ColumnDefinition>
                                    <ColumnDefinition Width="50"></ColumnDefinition>
                                    <ColumnDefinition Width="60"></ColumnDefinition>
                                    <ColumnDefinition Width="50"></ColumnDefinition>
                                </Grid.ColumnDefinitions>
                                <VerticalStackLayout Grid.Column="0" Margin="5,0">
                                    <Label Text="{Binding Path=TodoName}" HorizontalOptions="Start" VerticalOptions="Start" FontAttributes="Bold" FontSize="10"/>
                                    <Label Text="{Binding Path=Context}" HorizontalOptions="Start" VerticalOptions="Center" FontSize="14"/>
                                </VerticalStackLayout>
                                <VerticalStackLayout Grid.Column="1" VerticalOptions="Center">
                                    <Label Text="{Binding Path=Starts, StringFormat='{0:HH:mm}'}" HorizontalOptions="Center" FontSize="14" TextColor="#ccffdd"></Label>
                                    <Label Text="{Binding Path=Starts, StringFormat='{0:dd.MM.yy}'}" HorizontalOptions="Center" FontSize="10" TextColor="#ccffdd">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding Path=IsToday}" Value="True">
                                                <Setter Property="IsVisible" Value="False"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </VerticalStackLayout>
                                <Label Text="{Binding Path=GetDurationString}" Grid.Column="2" HorizontalOptions="Center" VerticalOptions="Start" FontAttributes="Bold" FontSize="14"></Label>
                                <Label Text="→" Grid.Column="2" HorizontalOptions="Center" VerticalOptions="End" TextColor="DimGrey"></Label>
                                <VerticalStackLayout Grid.Column="3" VerticalOptions="Center">
                                    <Label Text="{Binding Path=Ends, StringFormat='{0:HH:mm}'}" HorizontalOptions="Center" FontSize="14" TextColor="#ffe6dd"></Label>
                                    <Label Text="{Binding Path=Ends, StringFormat='{0:dd.MM.yy}'}" HorizontalOptions="Center" FontSize="10" TextColor="#ffe6dd">
                                        <Label.Triggers>
                                            <DataTrigger TargetType="Label" Binding="{Binding Path=IsToday}" Value="True">
                                                <Setter Property="IsVisible" Value="False"/>
                                            </DataTrigger>
                                        </Label.Triggers>
                                    </Label>
                                </VerticalStackLayout>
                            </Grid>
                        </Border>
                    </DataTemplate>
                </CollectionView.ItemTemplate>
            </CollectionView>
        </VerticalStackLayout>
    </Grid>
</ContentPage>
